<script src="/socket.io/socket.io.js"></script>
<script>
    // --- å®¢æˆ·ç«¯ Socket.IO åˆå§‹åŒ– ---
    // ç¡®ä¿è¿™é‡Œçš„URLæ˜¯ä½ è‡ªå·±çš„ï¼Œå¹¶ä¸”è¢«å¼•å·åŒ…è£¹
    const SERVER_URL = "https://hgtang.onrender.com";
    const socket = io(SERVER_URL);
    let myRole = null; // 'host' or 'player'

    // --- DOM å…ƒç´ è·å– (ä¸ä¹‹å‰ç›¸åŒ) ---
    const roleSelectionView = document.getElementById('role-selection');
    const hostView = document.getElementById('host-view');
    const playerView = document.getElementById('player-view');
    const questionInput = document.getElementById('question-input');
    const hostMessageArea = document.getElementById('host-message-area');
    const hostMessageInput = document.getElementById('host-message-input');
    const hostClueList = document.getElementById('host-clue-list');
    const btnSuccess = document.getElementById('btn-success');
    const btnFail = document.getElementById('btn-fail');
    const btnReset = document.getElementById('btn-reset');
    const playerQuestionDisplay = document.getElementById('player-question-display');
    const playerMessageArea = document.getElementById('player-message-area');
    const playerMessageInput = document.getElementById('player-message-input');
    const playerClueList = document.getElementById('player-clue-list');

    // --- æœ¬åœ°æ¸²æŸ“å‡½æ•° (åªè´Ÿè´£ç”»ç•Œé¢) ---
    function renderClues(clues) {
        hostClueList.innerHTML = '';
        playerClueList.innerHTML = '';
        clues.forEach(clue => {
            const hostLi = document.createElement('li');
            hostLi.className = `clue-item ${clue.highlighted ? 'highlighted' : ''}`;
            hostLi.innerHTML = `<span class="clue-text">${clue.text}</span><div class="clue-actions"><button class="highlight-btn" title="ç€é‡" onclick="toggleHighlightClue('${clue.id}')">â­</button><button class="delete-btn" title="åˆ é™¤" onclick="deleteClue('${clue.id}')">ğŸ—‘ï¸</button></div>`;
            hostClueList.appendChild(hostLi);
            const playerLi = document.createElement('li');
            playerLi.className = `clue-item ${clue.highlighted ? 'highlighted' : ''}`;
            playerLi.innerHTML = `<span class="clue-text">${clue.text}</span>`;
            playerClueList.appendChild(playerLi);
        });
    }

    function createMessageElement(data) {
        const { text, sender, role } = data;
        const className = role === 'host' ? 'host-msg' : 'player-msg';
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message', className);
        const senderSpan = document.createElement('div');
        senderSpan.classList.add('message-sender');
        senderSpan.textContent = sender;
        msgDiv.appendChild(senderSpan);
        msgDiv.appendChild(document.createTextNode(text));
        return msgDiv;
    }

    function appendLocalMessage(data) {
        const hostMsgDiv = createMessageElement(data);
        if (myRole === 'host' && data.role === 'player') {
            hostMsgDiv.title = 'ç‚¹å‡»åŠ å…¥çº¿ç´¢åˆ—è¡¨';
            hostMsgDiv.onclick = () => addClue(data.text);
        }
        hostMessageArea.appendChild(hostMsgDiv);
        hostMessageArea.scrollTop = hostMessageArea.scrollHeight;
        const playerMsgDiv = createMessageElement(data);
        playerMessageArea.appendChild(playerMsgDiv);
        playerMessageArea.scrollTop = playerMessageArea.scrollHeight;
    }

    // --- äº‹ä»¶å‘å°„å™¨ (å°†æ“ä½œå‘é€åˆ°æœåŠ¡å™¨) ---
    function selectRole(role) { socket.emit('selectRole', role); }
    function sendMessage(senderRole) { const input = senderRole === 'host' ? hostMessageInput : playerMessageInput; const text = input.value.trim(); if (!text) return; const senderName = senderRole === 'host' ? 'ä¸»æŒäºº' : 'ç©å®¶'; socket.emit('sendMessage', { text, sender: senderName, role: senderRole }); input.value = ''; }
    function quickReply(text) { socket.emit('sendMessage', { text, sender: 'ä¸»æŒäºº', role: 'host' }); }
    function addClue(text) { socket.emit('addClue', text); }
    function deleteClue(clueId) { socket.emit('deleteClue', clueId); }
    function toggleHighlightClue(clueId) { socket.emit('toggleHighlightClue', clueId); }
    function announceResult(result) { socket.emit('announceResult', result); }
    function resetGame() { socket.emit('resetGame'); }

    // --- Socket.IO äº‹ä»¶ç›‘å¬å™¨ (æ¥æ”¶æœåŠ¡å™¨çš„æ›´æ–°) ---
    socket.on('roleConfirmed', (role) => { myRole = role; roleSelectionView.classList.add('fade-out'); setTimeout(() => { roleSelectionView.style.display = 'none'; if (myRole === 'host') hostView.style.display = 'grid'; else playerView.style.display = 'grid'; }, 500); });
    socket.on('gameStateSync', (state) => { playerQuestionDisplay.textContent = state.question; questionInput.value = state.question; renderClues(state.clues); });
    socket.on('questionUpdated', (question) => { playerQuestionDisplay.textContent = question; questionInput.value = question; });
    socket.on('newMessage', (data) => { appendLocalMessage(data); });
    socket.on('cluesUpdated', (clues) => { renderClues(clues); });
    socket.on('resultAnnounced', (result) => { const resultText = `--- æ¸¸æˆç»“æŸï¼Œä¸»æŒäººå®£å¸ƒï¼šå–æ±¤${result}ï¼ ---`; const className = result === 'æˆåŠŸ' ? 'success' : 'fail'; const systemMsg = document.createElement('div'); systemMsg.className = `system-message ${className}`; systemMsg.textContent = resultText; hostMessageArea.appendChild(systemMsg.cloneNode(true)); playerMessageArea.appendChild(systemMsg.cloneNode(true)); hostMessageArea.scrollTop = hostMessageArea.scrollHeight; playerMessageArea.scrollTop = playerMessageArea.scrollHeight; btnSuccess.classList.add('hidden'); btnFail.classList.add('hidden'); btnReset.classList.remove('hidden'); });
    socket.on('gameReset', () => { hostMessageArea.innerHTML = ''; playerMessageArea.innerHTML = ''; hostClueList.innerHTML = ''; playerClueList.innerHTML = ''; questionInput.value = ''; playerQuestionDisplay.textContent = 'ä¸»æŒäººå°šæœªå‡ºé¢˜...'; btnSuccess.classList.remove('hidden'); btnFail.classList.remove('hidden'); btnReset.classList.add('hidden'); hostView.style.display = 'none'; playerView.style.display = 'none'; roleSelectionView.style.display = 'flex'; setTimeout(() => roleSelectionView.classList.remove('fade-out'), 50); });
    
    // --- åŸæœ‰äº‹ä»¶ç›‘å¬å™¨ç»‘å®š ---
    document.getElementById('host-btn').addEventListener('click', () => selectRole('host'));
    document.getElementById('player-btn').addEventListener('click', () => selectRole('player'));
    questionInput.addEventListener('input', (e) => socket.emit('updateQuestion', e.target.value));
    btnSuccess.addEventListener('click', () => announceResult('æˆåŠŸ'));
    btnFail.addEventListener('click', () => announceResult('å¤±è´¥'));
    btnReset.addEventListener('click', resetGame);
    document.getElementById('host-send-btn').addEventListener('click', () => sendMessage('host'));
    document.getElementById('player-send-btn').addEventListener('click', () => sendMessage('player'));
    hostMessageInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') sendMessage('host'); });
    playerMessageInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') sendMessage('player'); });
    function switchTab(view, tabName) { const tabs = document.querySelectorAll(`#${view}-view .tab-btn`); const contents = document.querySelectorAll(`#${view}-view .tab-content`); tabs.forEach(tab => tab.classList.remove('active')); contents.forEach(content => content.classList.remove('active')); document.querySelector(`#${view}-view .tab-btn[onclick*="'${tabName}'"]`).classList.add('active'); document.getElementById(`${view}-${tabName}-content`).classList.add('active'); }

    // æ·»åŠ  Eruda è°ƒè¯•å·¥å…·
    document.write('<script src="//cdn.jsdelivr.net/npm/eruda"><\/script>');
    document.addEventListener('DOMContentLoaded', function () {
        eruda.init();
    });
</script>        .game-result-buttons { margin-top: 15px; display: flex; gap: 10px; }
        .result-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; color: white; font-size: 1em; cursor: pointer; transition: opacity var(--transition-speed); }
        .result-btn:hover { opacity: 0.85; }
        #btn-success { background-color: var(--color-success); } #btn-fail { background-color: var(--color-fail); } #btn-reset { background-color: var(--color-reset); }
        .message-area { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
        .message { padding: 10px 15px; border-radius: 18px; margin-bottom: 12px; max-width: 80%; word-wrap: break-word; line-height: 1.5; }
        .message.player-msg { background-color: #eef1f5; align-self: flex-start; cursor: pointer; transition: background-color var(--transition-speed); }
        .message.player-msg:hover { background-color: #e3e8f0; }
        .message.host-msg { background-color: var(--color-secondary); color: white; align-self: flex-end; }
        .message-sender { font-weight: bold; font-size: 0.8em; margin-bottom: 4px; color: var(--color-primary); }
        .system-message { text-align: center; font-size: 0.9em; color: var(--color-text-light); padding: 10px; margin: 10px auto; width: 80%; border-radius: 8px; background-color: var(--color-bg); }
        .system-message.success { color: var(--color-success); font-weight: bold; } .system-message.fail { color: var(--color-fail); font-weight: bold; }
        .panel-footer { margin-top: auto; padding-top: 15px; border-top: 1px solid var(--color-border); }
        .quick-reply-buttons { display: flex; gap: 10px; margin-bottom: 15px; }
        .quick-reply-btn { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--color-secondary); background-color: transparent; color: var(--color-secondary); cursor: pointer; transition: all var(--transition-speed); }
        .quick-reply-btn:hover { background-color: var(--color-secondary); color: white; }
        .input-area { display: flex; gap: 10px; }
        .message-input { flex-grow: 1; padding: 12px; border: 1px solid var(--color-border); border-radius: 8px; font-size: 1em; font-family: var(--font-family); background-color: var(--color-bg); transition: all var(--transition-speed) ease; }
        .message-input:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(167, 178, 195, 0.2); background-color: white; }
        .send-btn { padding: 10px 20px; border: none; border-radius: 8px; background-color: var(--color-primary); color: white; cursor: pointer; transition: background-color var(--transition-speed); }
        .send-btn:hover { background-color: #8e9bb1; }
        .clue-list { flex-grow:1; overflow-y: auto; list-style-type: none; padding: 0; margin: 0; }
        .clue-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--color-border); transition: background-color var(--transition-speed); }
        .clue-item.highlighted { background-color: var(--color-highlight); font-weight: bold; }
        .clue-text { flex-grow: 1; line-height: 1.5; }
        .clue-actions button { background: none; border: none; cursor: pointer; margin-left: 8px; font-size: 1.2em; color: var(--color-text-light); transition: all var(--transition-speed); }
        .clue-actions button:hover { transform: scale(1.2); color: var(--color-text); }
        .delete-btn:hover { color: var(--color-fail) !important; } .highlight-btn:hover { color: var(--color-primary) !important; }
        .hidden { display: none !important; } .fade-out { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>
    <!-- HTML Bodyéƒ¨åˆ† -->
    <div id="role-selection"><h1>æµ·é¾Ÿæ±¤åœ¨çº¿å°å±‹</h1><div class="role-buttons"><button id="host-btn" class="role-btn">æˆ‘æ˜¯ä¸»æŒäºº</button><button id="player-btn" class="role-btn">æˆ‘æ˜¯ç©å®¶</button></div></div>
    <div id="host-view" class="game-container"><div class="panel"><div class="tab-nav"><button class="tab-btn active" onclick="switchTab('host', 'question')">æµ·é¾Ÿæ±¤é¢˜ç›®</button><button class="tab-btn" onclick="switchTab('host', 'manual')">ä¸»æŒäººæ‰‹å†Œ</button></div><div class="tab-content-container"><div id="host-question-content" class="tab-content active"><textarea id="question-input" class="editable-content" placeholder="åœ¨æ­¤è¾“å…¥â€œæ±¤é¢â€ï¼Œå°†å®æ—¶åŒæ­¥ç»™ç©å®¶..."></textarea></div><div id="host-manual-content" class="tab-content"><textarea id="manual-input" class="editable-content" placeholder="åœ¨æ­¤è¾“å…¥â€œæ±¤åº•â€ï¼Œä»…è‡ªå·±å¯è§..."></textarea></div></div><div class="game-result-buttons"><button id="btn-success" class="result-btn">å–æ±¤æˆåŠŸ</button><button id="btn-fail" class="result-btn">å–æ±¤å¤±è´¥</button><button id="btn-reset" class="result-btn hidden">é‡ç½®æ¸¸æˆ</button></div></div><div class="panel"><h3 class="panel-title">ä¿¡æ¯äº’åŠ¨åŒº</h3><div id="host-message-area" class="message-area"></div><div class="panel-footer"><div class="quick-reply-buttons"><button class="quick-reply-btn" onclick="quickReply('æ˜¯')">æ˜¯</button><button class="quick-reply-btn" onclick="quickReply('ä¸æ˜¯')">ä¸æ˜¯</button><button class="quick-reply-btn" onclick="quickReply('æ˜¯ä¹Ÿä¸æ˜¯')">æ˜¯ä¹Ÿä¸æ˜¯</button></div><div class="input-area"><input type="text" id="host-message-input" class="message-input" placeholder="è¾“å…¥è‡ªå®šä¹‰å›å¤..."><button id="host-send-btn" class="send-btn">å‘é€</button></div></div></div><div class="panel"><h3 class="panel-title">çº¿ç´¢åˆ—è¡¨</h3><ul id="host-clue-list" class="clue-list"></ul></div></div>
    <div id="player-view" class="game-container"><div class="panel"><h3 class="panel-title">æµ·é¾Ÿæ±¤é¢˜ç›®</h3><div id="player-question-display" style="font-size: 1.1em; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; overflow-y: auto; flex-grow: 1;">ä¸»æŒäººå°šæœªå‡ºé¢˜...</div></div><div class="panel"><h3 class="panel-title">æé—®åŒº</h3><div id="player-message-area" class="message-area"></div><div class="panel-footer"><div class="input-area"><input type="text" id="player-message-input" class="message-input" placeholder="å‘ä¸»æŒäººæé—®..."><button id="player-send-btn" class="send-btn">å‘é€</button></div></div></div><div class="panel"><h3 class="panel-title">çº¿ç´¢åˆ—è¡¨</h3><ul id="player-clue-list" class="clue-list"></ul></div></div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // è¿™é‡Œç²˜è´´ä¹‹å‰æœ€ç»ˆç‰ˆçš„å…¨éƒ¨å®¢æˆ·ç«¯JavaScriptä»£ç 
        const socket = io("https://hgtang.onrender.com"); let myRole = null;
        const roleSelectionView = document.getElementById('role-selection'); const hostView = document.getElementById('host-view'); const playerView = document.getElementById('player-view'); const questionInput = document.getElementById('
